

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>heterograph: queries &mdash; heterograph 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/css/label.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="heterograph: visualisation" href="4-hgraph-visualisation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            heterograph
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks.html">Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-hgraph-basics.html">heterograph: basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-hgraph-ops.html">heterograph: graph operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-hgraph-pmaps.html">heterograph: property maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-hgraph-visualisation.html">heterograph: visualisation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">heterograph: queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Query-Graphs-(qgraph)">Query Graphs (qgraph)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#AQL-grammar">AQL grammar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bulding-qgraphs">bulding qgraphs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Query-Processor-DFS">Query Processor DFS</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">heterograph</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../notebooks.html">Notebooks</a></li>
      <li class="breadcrumb-item active">heterograph: queries</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks_/5-hgraph-queries.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="heterograph:-queries">
<h1>heterograph: queries<a class="headerlink" href="#heterograph:-queries" title="Link to this heading"></a></h1>
<p>Heterograph provides functionality to identify specific patterns, or subgraphs, within larger graphs using DFS (Depth-First Search). This is achieved through the use of a <code class="docutils literal notranslate"><span class="pre">qgraph</span></code> (query graph). The <code class="docutils literal notranslate"><span class="pre">qgraph</span></code> encodes a subgraph pattern, which is then used as a query to locate instances of this pattern within a larger graph. For example, in a graph that represents a C++ program, a qgraph could be used to identify all the loops. To construct these qgraphs, Heterograph utilizes a query language
known as ‘AQL’. We use this facility in Artisan, but it is kept generic for other uses.</p>
<section id="Query-Graphs-(qgraph)">
<h2>Query Graphs (qgraph)<a class="headerlink" href="#Query-Graphs-(qgraph)" title="Link to this heading"></a></h2>
<section id="AQL-grammar">
<h3>AQL grammar<a class="headerlink" href="#AQL-grammar" title="Link to this heading"></a></h3>
<p>AQL has the following syntax:</p>
<ul class="simple">
<li><p><strong>identifiers</strong>: Start with a letter, followed by letters, numbers, or underscores.</p>
<ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">person</span></code>, <code class="docutils literal notranslate"><span class="pre">node1</span></code></p></li>
</ul>
</li>
<li><p><strong>arguments</strong>:</p>
<ul>
<li><p>Single or comma-separated values, e.g.: <code class="docutils literal notranslate"><span class="pre">&quot;Alice&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">30,</span> <span class="pre">&quot;Engineer&quot;</span></code></p></li>
<li><p>Key-Value Pairs: Use <code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code>, e.g.: <code class="docutils literal notranslate"><span class="pre">name:</span> <span class="pre">&quot;Alice&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">age:</span> <span class="pre">30</span></code></p></li>
</ul>
</li>
<li><p><strong>nodes</strong>: Identifier alone or with arguments.</p>
<ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">person</span></code>, <code class="docutils literal notranslate"><span class="pre">person</span> <span class="pre">{</span> <span class="pre">name:</span> <span class="pre">&quot;Alice&quot;,</span> <span class="pre">age:</span> <span class="pre">30</span> <span class="pre">}</span></code></p></li>
</ul>
</li>
<li><p><strong>edges</strong>: Simple (<code class="docutils literal notranslate"><span class="pre">=&gt;</span></code>) or with arguments (<code class="docutils literal notranslate"><span class="pre">={</span> <span class="pre">args</span> <span class="pre">}&gt;</span></code>).</p>
<ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">={</span> <span class="pre">weight:</span> <span class="pre">5</span> <span class="pre">}&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">={</span> <span class="pre">10,</span> <span class="pre">12</span> <span class="pre">}&gt;</span></code></p></li>
</ul>
</li>
<li><p><strong>graphs</strong>: Group of graphs, single node, or connected graphs.</p>
<ul>
<li><p>Example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> # empty graph</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node1</span> <span class="pre">=&gt;</span> <span class="pre">node2</span></code> # edge between node1 and node2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(node1</span> <span class="pre">|</span> <span class="pre">node2)</span> <span class="pre">=&gt;</span> <span class="pre">node3</span></code> # node1 and node2 are both connected to node3</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="bulding-qgraphs">
<h3>bulding qgraphs<a class="headerlink" href="#bulding-qgraphs" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heterograph.query.qgraph</span><span class="w"> </span><span class="kn">import</span> <span class="n">QGraph</span>

<span class="n">QGraph</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;A =&gt; B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks__5-hgraph-queries_1_0.svg" src="../_images/notebooks__5-hgraph-queries_1_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">QGraph</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;(A | B) =&gt; C&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks__5-hgraph-queries_2_0.svg" src="../_images/notebooks__5-hgraph-queries_2_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">QGraph</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;X=&gt;(A|B)=&gt;(C|D)=&gt;E&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks__5-hgraph-queries_3_0.svg" src="../_images/notebooks__5-hgraph-queries_3_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">QGraph</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;a{name:&quot;A&quot;} ={d:True}&gt;b{name:&quot;B&quot;}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks__5-hgraph-queries_4_0.svg" src="../_images/notebooks__5-hgraph-queries_4_0.svg" />
</div>
</div>
</section>
</section>
<section id="Query-Processor-DFS">
<h2>Query Processor DFS<a class="headerlink" href="#Query-Processor-DFS" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">QueryProcessorDFS</span></code> class is utilized to identify specific subgraph patterns within a larger, arbitrary graph (<code class="docutils literal notranslate"><span class="pre">HGraph</span></code>). After creating an instance of this class, the <code class="docutils literal notranslate"><span class="pre">run</span></code> method can be invoked with the appropriate parameters to execute the search:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code>: This is the graph to be queried. It should be an instance of HGraph.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qgraph</span></code>: This is the query graph, an instance of QGraph, which represents the pattern you’re looking for in the main graph.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vs</span></code>: This is a list of vertices from which the query should start (roots)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path_check</span></code>: This is a function that checks the validity of a path. It should take a path as input and return a boolean indicating whether the path is valid.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">match_filter</span></code>: This is a function that filters the matches. It should take a match as input and return a boolean indicating whether the match should be included in the results.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fd</span></code>: This is an optional parameter that specifies the distance between the root (specified in <code class="docutils literal notranslate"><span class="pre">vs</span></code>) and first node of a match. It can be an integer or a tuple of two integers. If it is an integer, the distance must be exactly that integer. If it is a tuple, the distance must be within the range specified by the tuple.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gd</span></code>: This is an optional parameter that specifies the distance between the root (specified in <code class="docutils literal notranslate"><span class="pre">vs</span></code>) and any node of a match. It can be an integer or a tuple of two integers. If it is an integer, the distance must be exactly that integer. If it is a tuple, the distance must be within the range specified by the tuple.</p></li>
</ul>
<p>As an example, consider the following graph where each vertex has a label and a type (circle or rect).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heterograph</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">HGraph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">add_vx</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;circle&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;rect&quot;</span>

    <span class="n">g</span><span class="o">.</span><span class="n">vstyle</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">vx</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">g</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">vx</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">g</span><span class="o">.</span><span class="n">vstyle</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">vx</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

<span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks__5-hgraph-queries_6_0.svg" src="../_images/notebooks__5-hgraph-queries_6_0.svg" />
</div>
</div>
<p>For our example, we develop a query system that matches specific constraints, namely label and type. The initial step in this process involves transferring AQL arguments into the vertices of the query graph. For this, we create the <code class="docutils literal notranslate"><span class="pre">vx_args</span></code> function which is be passed to <code class="docutils literal notranslate"><span class="pre">QGraph</span></code> constructor when we create a query.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we will pass this function when we create a QGraph</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vx_args</span><span class="p">(</span><span class="n">qg</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">qg</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">qg</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
</pre></div>
</div>
</div>
<p>Next, we set up the query processor. This involves defining two optional functions: <code class="docutils literal notranslate"><span class="pre">path_check</span></code> and <code class="docutils literal notranslate"><span class="pre">match_filter</span></code>. The <code class="docutils literal notranslate"><span class="pre">path_check</span></code> function is used to verify if any two vertices from the query graph correspond to two vertices in the main graph. If <code class="docutils literal notranslate"><span class="pre">True</span></code> then then become part of the match. The <code class="docutils literal notranslate"><span class="pre">match_filter</span></code> function is used to filter out the complete matches based on certain criteria.</p>
<p>In our example, we use <code class="docutils literal notranslate"><span class="pre">path_check</span></code> to check if vertex constraints, such as name or type match.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heterograph.query.processor_dfs</span><span class="w"> </span><span class="kn">import</span> <span class="n">QueryProcessorDFS</span>

<span class="k">def</span><span class="w"> </span><span class="nf">path_check</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">gchain</span><span class="p">,</span> <span class="n">qgchain</span><span class="p">):</span>
    <span class="c1"># This allows for a comparison between two vertices that form a path (q_vpair) and</span>
    <span class="c1"># two vertices from the query graph (g_vpair). For example, it can be used to</span>
    <span class="c1"># implement distance constraints between two vertices. In this case, we check the</span>
    <span class="c1"># vertex contraints match</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">gchain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">qvx</span> <span class="o">=</span> <span class="n">qgchain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">qg</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">qvx</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># match the exact attribute value, we could</span>
            <span class="c1"># use regex or other matching</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">vx</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">!=</span> <span class="n">qg</span><span class="o">.</span><span class="n">pmap</span><span class="p">[</span><span class="n">qvx</span><span class="p">][</span><span class="n">attr</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>

<span class="n">processor</span> <span class="o">=</span> <span class="n">QueryProcessorDFS</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now, let us create a query: find all <code class="docutils literal notranslate"><span class="pre">circle</span></code> vertices.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qg</span><span class="o">=</span><span class="n">QGraph</span><span class="p">(</span><span class="s1">&#39;x{type:&quot;circle&quot;}&#39;</span><span class="p">,</span> <span class="n">vx_args</span><span class="o">=</span><span class="n">vx_args</span><span class="p">)</span>

<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;x&#39;: 4}, {&#39;x&#39;: 4}, {&#39;x&#39;: 2}, {&#39;x&#39;: 4}, {&#39;x&#39;: 0}]
</pre></div></div>
</div>
<p>Each match corresponds to a mapping from a vertex in the query graph (qgraph) to a vertex in the main graph. It is important to note, as shown above, that duplicates may occur. For this purpose, the <code class="docutils literal notranslate"><span class="pre">QueryResultSe</span></code>t class is used to refine these results and optionally perform actions on them. One such action is the removal of identical results, which can be achieved using the <code class="docutils literal notranslate"><span class="pre">RSet::distinct</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heterograph.query.resultset</span><span class="w"> </span><span class="kn">import</span> <span class="n">QueryResultSet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">heterograph.query.rsutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSet</span>

<span class="n">qrs</span> <span class="o">=</span> <span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
<span class="n">qrs</span> <span class="o">=</span> <span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">qrs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x
---
  <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">2</span>
  <span class="ansi-black-intense-fg">0</span>
</pre></div></div>
</div>
<p>Now, let us do a more complex query and find a circle vertex connected to a vertex of any type.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qg</span><span class="o">=</span><span class="n">QGraph</span><span class="p">(</span><span class="s1">&#39;x{type:&quot;circle&quot;}=&gt;y&#39;</span><span class="p">,</span> <span class="n">vx_args</span><span class="o">=</span><span class="n">vx_args</span><span class="p">)</span>

<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">)</span>
<span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x    y
---  ---
  <span class="ansi-black-intense-fg">4</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">1</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">2</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">3</span>
</pre></div></div>
</div>
<p>Please note that each entry in the list of matches is independent. Furthermore, although the distance between vertices <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> is not explicitly constrained, it is guaranteed that <code class="docutils literal notranslate"><span class="pre">y</span></code> is part of the path when <code class="docutils literal notranslate"><span class="pre">x</span></code> is visited. To specify distance constraints, you can add a constraint to the edge in the query graph (qgraph). The <code class="docutils literal notranslate"><span class="pre">eg_args</span></code> parameter can then be used to translate AQL edge arguments into the qgraph edge property map, similar to how <code class="docutils literal notranslate"><span class="pre">vx_args</span></code> is used for vertices.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">QueryProcessorDFS</span></code> class includes two optional global parameters, <code class="docutils literal notranslate"><span class="pre">fd</span></code> and <code class="docutils literal notranslate"><span class="pre">gd</span></code>, which filters out matches.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fd</span></code> parameter is a tuple (min, max) that defines the minimum and maximum distance between the root vertex, where the search begins, and the first element found in the match. If a single integer <code class="docutils literal notranslate"><span class="pre">d</span></code> is provided, it is interpreted as both the minimum and maximum distance.</p>
<p>For the above example, the search starts with root vertex 0 (“A”). So if we specify fd=1, then we have:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># without &quot;fd&quot; constraint</span>
<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">)))</span>

<span class="c1"># with fd=1. x=2 is exactly 1 edge away from the root vertex 0</span>
<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x    y
---  ---
  <span class="ansi-black-intense-fg">4</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">1</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">2</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">3</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x    y
---  ---
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">4</span>
</pre></div></div>
</div>
<p>On the other hand, the <code class="docutils literal notranslate"><span class="pre">gd</span></code> parameter follows the same distance type as <code class="docutils literal notranslate"><span class="pre">fd</span></code>, that is (int,int) or int. It provides the distance between root vertex 0 (“A”) where the search starts and any node in a match. In this example, we specify the <code class="docutils literal notranslate"><span class="pre">gd</span></code> distance between (0, 2).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># without &quot;gd&quot; constraint</span>
<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">)))</span>

<span class="c1"># with gd=(0, 2). Note that (4, 5) and (2, 5), for instance, do not meet the distance constraint</span>
<span class="c1"># since vertex 5 has a distance of 3 from the root vertex 0.</span>
<span class="n">matches</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">path_check</span><span class="o">=</span><span class="n">path_check</span><span class="p">,</span> <span class="n">gd</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">RSet</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">QueryResultSet</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">qg</span><span class="p">,</span> <span class="n">matches</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x    y
---  ---
  <span class="ansi-black-intense-fg">4</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">5</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">1</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">2</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">3</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  x    y
---  ---
  <span class="ansi-black-intense-fg">2</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">4</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">1</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">2</span>
  <span class="ansi-black-intense-fg">0</span>    <span class="ansi-black-intense-fg">3</span>
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="4-hgraph-visualisation.html" class="btn btn-neutral float-left" title="heterograph: visualisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Custom Computing Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>